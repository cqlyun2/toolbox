import{o as p,c as g,a as l,v as f,A as I,x as o,z as r,F as X,r as Y,n as z,t as B,b as F,d as u,e as H}from"./index-4sC0TyPp.js";const N={class:"space-y-6"},W={key:0,class:"space-y-4"},j={class:"relative inline-block"},E=["src"],P={class:"grid md:grid-cols-4 gap-4"},S={class:"flex items-center space-x-4"},$=["onClick"],A={__name:"ImageCrop",setup(G){const i=u(""),n=u(null),t=u({x:0,y:0,width:200,height:200}),c=u("free"),y=[{label:"自由",value:"free"},{label:"1:1",value:"1:1"},{label:"4:3",value:"4:3"},{label:"16:9",value:"16:9"}];let d=!1,b=0,h=0;const w=H(()=>({left:t.value.x+"px",top:t.value.y+"px",width:t.value.width+"px",height:t.value.height+"px"})),k=a=>{const e=a.target.files[0];e&&x(e)},M=a=>{const e=a.dataTransfer.files[0];e&&e.type.startsWith("image/")&&x(e)},x=a=>{i.value=URL.createObjectURL(a)},C=()=>{n.value&&(n.value.naturalWidth,n.value.naturalHeight,t.value={x:0,y:0,width:n.value.width/2,height:n.value.height/2})},D=a=>{if(c.value=a,a==="free")return;const[e,s]=a.split(":").map(Number),v=t.value.width*s/e;t.value.height=Math.min(v,n.value.height-t.value.y)},L=a=>{d=!0,b=a.clientX-t.value.x,h=a.clientY-t.value.y},R=a=>{d&&(t.value.x=Math.max(0,Math.min(a.clientX-b,n.value.width-t.value.width)),t.value.y=Math.max(0,Math.min(a.clientY-h,n.value.height-t.value.height)))},U=()=>{d=!1},V=()=>{const a=document.createElement("canvas"),e=n.value.naturalWidth/n.value.width,s=n.value.naturalHeight/n.value.height;a.width=t.value.width*e,a.height=t.value.height*s,a.getContext("2d").drawImage(n.value,t.value.x*e,t.value.y*s,t.value.width*e,t.value.height*s,0,0,a.width,a.height);const m=document.createElement("a");m.href=a.toDataURL("image/png"),m.download="cropped.png",m.click()};return(a,e)=>(p(),g("div",N,[l("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-all cursor-pointer",onClick:e[0]||(e[0]=s=>a.$refs.fileInput.click()),onDragover:e[1]||(e[1]=f(()=>{},["prevent"])),onDrop:f(M,["prevent"])},[l("input",{ref:"fileInput",type:"file",accept:"image/*",onChange:k,class:"hidden"},null,544),e[6]||(e[6]=l("svg",{class:"w-12 h-12 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),e[7]||(e[7]=l("p",{class:"text-gray-600"},"点击或拖拽上传图片",-1)),e[8]||(e[8]=l("p",{class:"text-sm text-gray-400 mt-1"},"支持 JPG, PNG, WebP 格式",-1))],32),i.value?(p(),g("div",W,[l("div",j,[l("img",{ref_key:"imgRef",ref:n,src:i.value,class:"max-w-full rounded-lg border",onLoad:C},null,40,E),l("div",{class:"absolute border-2 border-dashed border-blue-500 bg-blue-500/20",style:I(w.value),onMousedown:L,onMousemove:R,onMouseup:U},null,36)]),l("div",P,[l("div",null,[e[9]||(e[9]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"X",-1)),o(l("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.x=s),type:"number",class:"w-full px-4 py-2 border rounded-lg"},null,512),[[r,t.value.x,void 0,{number:!0}]])]),l("div",null,[e[10]||(e[10]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Y",-1)),o(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.y=s),type:"number",class:"w-full px-4 py-2 border rounded-lg"},null,512),[[r,t.value.y,void 0,{number:!0}]])]),l("div",null,[e[11]||(e[11]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"宽度",-1)),o(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.width=s),type:"number",class:"w-full px-4 py-2 border rounded-lg"},null,512),[[r,t.value.width,void 0,{number:!0}]])]),l("div",null,[e[12]||(e[12]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"高度",-1)),o(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.height=s),type:"number",class:"w-full px-4 py-2 border rounded-lg"},null,512),[[r,t.value.height,void 0,{number:!0}]])])]),l("div",S,[e[13]||(e[13]=l("span",{class:"text-sm text-gray-600"},"预设比例:",-1)),(p(),g(X,null,Y(y,s=>l("button",{key:s.value,onClick:v=>D(s.value),class:z(["px-3 py-1 rounded text-sm transition-all",c.value===s.value?"bg-blue-500 text-white":"bg-gray-100 text-gray-600"])},B(s.label),11,$)),64))]),l("div",{class:"flex justify-center"},[l("button",{onClick:V,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all"}," 下载裁剪图片 ")])])):F("",!0)]))}};export{A as default};
